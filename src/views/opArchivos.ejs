<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operación con Archivos</title>
    <%- include('partials/head') %>
</head>
<body>
    
    <%- include('partials/navigation') %>

    <center>

        <h1>Emulación de File System</h1>

        <div class="container-custom mt-4">
            <form method="post">
                <div class="form-ext">
                    <h2 class="text-center">Operaciones con Archivos</h2>
                    <div class="accordion" id="accordionExample">
                        <%- include('partials/crearArchivo') %>        
                    </div>
                </div>
            </form>
            <form method="post"></form>
                <div class="form-ext">
                    <div class="accordion" id="accordionExample">
                        <%- include('partials/guardarArchivo') %>
                    </div>
                </div>
            </form>
            <form method="post"></form>
                <div class="form-ext">
                    <div class="accordion" id="accordionExample">
                        <%- include('partials/eliminarArchivo') %>
                    </div>
                </div>
            </form>
            <form method="post"></form>
                <div class="form-ext">
                    <div class="accordion" id="accordionExample">
                        <%- include('partials/moverArchivo') %>
                    </div>
                </div>
            </form>
        </div>
        
    </center>
    
    <!-- JavaScript para manejar el formulario de Crear Archivo -->
    <script>
        document.getElementById('crearArchivoForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Evitar la recarga de la página
        
            // Obtener los valores del formulario
            const formData = {
                nombreArchivo: document.getElementById('nombreArchivo').value,
                tipoArchivo: document.getElementById('tipoArchivo').value,
                pesoArchivo: document.getElementById('pesoArchivo').value,
                rutaArchivo: document.getElementById('rutaArchivo').value
            };
        
            // Enviar la petición usando fetch
            fetch('/opArchivos', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.text()) // Esperar el mensaje de éxito
            .then(data => {
                // Mostrar el mensaje en una ventana emergente o alerta
                alert(data);
                // Opcional: Limpiar el formulario después de enviar
                document.getElementById('crearArchivoForm').reset();
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>

    <!-- JavaScript para manejar el formulario de Eliminar Archivo -->
    <script>
        function eliminarArchivo() {
            const nombreEliminar = document.getElementById('nombreEliminar').value;
            const tipoEliminar = document.getElementById('tipoEliminar').value;
            const rutaEliminar = document.getElementById('rutaEliminar').value;
    
            fetch('/eliminarArchivo', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ nombreEliminar, tipoEliminar, rutaEliminar })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => {
                console.error('Error al eliminar el archivo:', error);
            });
        }
    </script>

    <!-- JavaScript para manejar el formulario de Guardar/Reemplazar Archivo -->
    <script>
        function guardarArchivo(){
            document.getElementById('guardarCambiosBtn').addEventListener('click', function() {
            // Capturamos los valores de los campos
            const nombreArchivoExistente = document.getElementById('nombreArchivoExistente').value;
            const tipoArchivo = document.getElementById('tipoArchivo').value;
            const rutaArchivoExistente = document.getElementById('rutaArchivoExistente').value;
            const nombreArchivoNuevo = document.getElementById('nombreArchivoNuevo').value;
            const pesoArchivoNuevo = document.getElementById('pesoArchivoNuevo').value;

            // Validamos que se hayan ingresado los datos necesarios
            if (!nombreArchivoExistente || !nombreArchivoNuevo || !pesoArchivoNuevo) {
            alert('Por favor, completa todos los campos.');
            return;
            }

            // Enviamos la solicitud POST con los datos
            fetch('/guardarArchivo', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                nombreArchivoExistente,
                tipoArchivo,
                rutaArchivoExistente,
                nombreArchivoNuevo,
                pesoArchivoNuevo
            }),
            })
            .then(response => response.json())
            .then(data => {
            console.log('Archivo guardado:', data);
            })
            .catch((error) => {
            console.error('Error:', error);
                });
            });
        }
    </script>

    <!-- JavaScript para manejar el formulario de Mover Archivo -->
    <script>
        function moverArchivo(){
            document.getElementById('moverArchivoForm').addEventListener('submit', function(e) {
            e.preventDefault();  // Evita que el formulario se envíe de manera tradicional

            // Recoger los datos del formulario
            const nombreArchivo = document.getElementById('nombreArchivo').value;
            const tipoArchivo = document.getElementById('tipoArchivo').value;
            const rutaArchivo = document.getElementById('rutaArchivo').value;
            const nuevaRutaArchivo = document.getElementById('nuevaRutaArchivo').value;

            // Crear el objeto que será enviado al servidor
            const datos = {
            nombreArchivo,
            tipoArchivo,
            rutaArchivo,
            nuevaRutaArchivo
            };

            // Enviar los datos al servidor usando fetch
            fetch('/moverArchivo', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(datos)
            })
            .then(response => response.json())
            .then(data => {
            // Mostrar la respuesta del servidor en el DOM
            const respuestaServidor = document.getElementById('respuestaServidor');
            respuestaServidor.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
            })
            .catch(err => {
            // Mostrar el error si ocurre
            const respuestaServidor = document.getElementById('respuestaServidor');
            respuestaServidor.innerHTML = `<div class="alert alert-danger">Error al mover el archivo: ${err.message}</div>`;
                });
            });
        }
    </script>

</body>
</html>